{"ast":null,"code":"import _objectSpread from\"/home/dehlia/prospection/tableau-entreprises/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState}from'react';import L from'leaflet';import'leaflet/dist/leaflet.css';import'./MapProspect.css';// Fix des ic√¥nes Leaflet\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',iconUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'});export default function MapProspects(_ref){let{onSearch}=_ref;const mapRef=useRef(null);const mapInstance=useRef(null);const markersRef=useRef([]);const[data,setData]=useState([]);const[filteredData,setFilteredData]=useState([]);const[companyName,setCompanyName]=useState('');const[postalCode,setPostalCode]=useState('');const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[center,setCenter]=useState({lat:48.8566,lng:2.3522});const[filters,setFilters]=useState({radius:100,hasEmail:false,hasPhone:false});const[favorites,setFavorites]=useState(()=>{return new Set(JSON.parse(localStorage.getItem('favorites')||'[]'));});const[selectedCompany,setSelectedCompany]=useState(null);// Calcul distance (Haversine)\nconst calculateDistance=(lat1,lon1,lat2,lon2)=>{const R=6371;const dLat=(lat2-lat1)*Math.PI/180;const dLon=(lon2-lon1)*Math.PI/180;const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;};const geocodePostal=async cp=>{try{var _json$features;const res=await fetch(\"https://api-adresse.data.gouv.fr/search/?q=\".concat(encodeURIComponent(cp),\"&limit=1\"));const json=await res.json();const feat=(_json$features=json.features)===null||_json$features===void 0?void 0:_json$features[0];if(!feat)return null;const[lon,lat]=feat.geometry.coordinates;return{lat,lng:lon};}catch(error){console.error('Erreur de g√©ocodage:',error);return null;}};// util pour extraire pr√©nom/nom √† partir de \"Pr√©nom Nom\"\nconst splitName=function(){let fullName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";const parts=fullName.trim().split(\" \");if(parts.length===1)return{firstname:parts[0],lastname:\"\"};const firstname=parts[0];const lastname=parts.slice(1).join(\" \");return{firstname,lastname};};// util pour extraire le domaine d'une URL\nconst getDomainFromUrl=function(){let url=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";if(!url)return\"\";try{const u=new URL(url.startsWith(\"http\")?url:\"https://\".concat(url));return u.hostname.replace(/^www\\./,\"\");}catch(_unused){return url.replace(/^https?:\\/\\//,\"\").replace(/^www\\./,\"\").split(\"/\")[0];}};// Appel de l'endpoint /enrich-contact pour un contact\nconst enrichContactWithFullEnrich=async(company,contact)=>{try{const{firstname,lastname}=splitName(contact.nom||contact.name||\"\");if(!firstname){alert(\"Impossible d'enrichir: le contact n'a pas de nom.\");return;}const domain=getDomainFromUrl(company.site);const res=await fetch(\"http://localhost:5000/enrich-contact\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({firstname,lastname,company_name:company.name,domain,linkedin_url:contact.linkedin||\"\"})});const data=await res.json();if(!res.ok){alert(data.error||\"Erreur FullEnrich\");console.error(\"FullEnrich error:\",data);return;}if(!data.data||data.data.length===0){alert(\"Aucune donn√©e suppl√©mentaire trouv√©e par FullEnrich.\");return;}const enriched=data.data[0];alert(\"Enrichi :\\n\"+\"Nom: \".concat(enriched.nom,\"\\n\")+\"Poste: \".concat(enriched.poste,\"\\n\")+\"Email: \".concat(enriched.email||\"N/A\",\"\\n\")+\"T\\xE9l\\xE9phone: \".concat(enriched.telephone||\"N/A\"));}catch(err){console.error(\"Erreur enrich-contact:\",err);alert(\"Erreur r√©seau FullEnrich\");}};// Manuel: lance l'enrichissement FullEnrich sur un nombre limit√© de contacts (√©vite boucle automatique)\nconst startAutoEnrich=async function(){let limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:8;let enrichedCount=0;for(const company of data){if(!company||!company.contacts||company.contacts.length===0)continue;for(const contact of company.contacts){// n'enrichit que les contacts sans email ni t√©l√©phone pour limiter les appels\nconst hasEmail=contact.email&&contact.email.trim().length>0;const hasPhone=contact.telephone&&contact.telephone.toString().replace(/\\D/g,'').length>0;if(hasEmail||hasPhone)continue;if(enrichedCount>=limit)return;await enrichContactWithFullEnrich(company,contact);enrichedCount+=1;await new Promise(r=>setTimeout(r,400));}}};// Process contacts: limit standard t√©l√©phonique to max 2 per company\nconst processContacts=function(){let contacts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(!Array.isArray(contacts)||contacts.length===0)return[];const isStandard=c=>{const name=(c.nom||c.name||\"\").toLowerCase();const poste=(c.poste||c.position||\"\").toLowerCase();return name.includes('standard')||poste.includes('standard')||poste.includes('accueil');};const normalizePhone=function(){let p=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";return(p||\"\").toString().replace(/\\D/g,'');};const nonStandards=contacts.filter(c=>!isStandard(c));const standardCandidates=contacts.filter(c=>isStandard(c));// Deduplicate standard candidates by phone (keep first seen)\nconst seenPhones=new Set();const selectedStandards=[];for(const s of standardCandidates){const phone=normalizePhone(s.telephone||s.phone||'');if(phone){if(!seenPhones.has(phone)){seenPhones.add(phone);selectedStandards.push(_objectSpread(_objectSpread({},s),{},{telephone:s.telephone||s.phone||''}));}}else{// if no phone, keep but limited\nselectedStandards.push(s);}if(selectedStandards.length>=2)break;// limit to 2\n}// If we still have less than 2 standards and some candidates had no phone, fill up to 2\nif(selectedStandards.length<2){for(const s of standardCandidates){if(selectedStandards.includes(s))continue;selectedStandards.push(s);if(selectedStandards.length>=2)break;}}return[...nonStandards,...selectedStandards];};// FONCTION DE RECHERCHE UNIFI√âE\nconst handleSearch=async e=>{if(e)e.preventDefault();if(!companyName||!postalCode){setError('Nom et code postal requis');return;}setLoading(true);setError(null);try{// 1. G√âOCODAGE D'ABORD pour avoir un centre pr√©cis\nconst centerFromCp=await geocodePostal(postalCode);if(!centerFromCp){setError('Code postal introuvable');setLoading(false);return;}setCenter(centerFromCp);// 2. Appel backend\nconst res=await fetch('http://localhost:5000/prospect',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({companyName,postalCode,radiusKm:filters.radius||100})});const text=await res.text();let js=null;try{js=text?JSON.parse(text):null;}catch(parseErr){setError(\"R\\xE9ponse inattendue du serveur (status \".concat(res.status,\")\"));setLoading(false);return;}if(!res.ok){var _js;setError(((_js=js)===null||_js===void 0?void 0:_js.error)||\"Erreur serveur (\".concat(res.status,\")\"));setLoading(false);return;}// util pour extraire pr√©nom/nom √† partir de \"Pr√©nom Nom\"\n// 3. Mapping des entreprises\nconst companies=(js.data||[]).map((c,i)=>({id:i,name:c.nom||c.nom_entreprise||\"Inconnu\",address:c.adresse||c.adresse_siege||\"\",sector:c.secteur||c.libelle_activite_principale||c.libelle_naf||\"\",site:c.site_web||c.site||\"\",telephone:c.telephone||\"\",// Les contacts sont d√©j√† limit√©s et trait√©s par le backend (pas besoin de processContacts ici)\ncontacts:c.contacts||[],latitude:c.latitude||c.lat||null,longitude:c.longitude||c.lng||null,ville:c.ville||\"\",code_postal:c.code_postal||\"\",adresse:c.adresse||\"\",naf:c.naf||c.activite_principale||\"\",siren:c.siren||\"temp-\".concat(i)}));// Option : lancer FullEnrich automatiquement sur chaque contact\nconst autoEnrich=async()=>{for(const company of companies){if(!company.site||!company.contacts||company.contacts.length===0)continue;for(const contact of company.contacts){// tu peux mettre des conditions si tu veux √©viter de tout enrichir\n// ex : si pas d'email ou pas de t√©l√©phone\n// if (contact.email && contact.telephone) continue;\nawait enrichContactWithFullEnrich(company,contact);// √©ventuellement un petit d√©lai pour ne pas spammer l‚ÄôAPI\nawait new Promise(r=>setTimeout(r,300));}}};// Ne lance pas automatiquement l'enrichissement pour √©viter des appels r√©p√©t√©s\n// autoEnrich();\nsetData(companies);// 4. FILTRAGE UNIFI√â avec toutes les conditions\nconst filtered=companies.filter(company=>{// V√©rification des coordonn√©es\nconst lat=parseFloat(company.latitude);const lng=parseFloat(company.longitude);if(!lat||!lng||isNaN(lat)||isNaN(lng))return false;// Filtre distance\nconst distance=calculateDistance(centerFromCp.lat,centerFromCp.lng,lat,lng);if(distance>filters.radius)return false;// Filtre email\nif(filters.hasEmail&&(!company.contacts||!company.contacts.some(c=>c.email))){return false;}// Filtre t√©l√©phone\nif(filters.hasPhone&&!company.telephone&&(!company.contacts||!company.contacts.some(c=>c.telephone))){return false;}return true;});setFilteredData(filtered);// 5. Centrage de la carte sur le CP g√©ocod√©\nif(mapInstance.current){mapInstance.current.setView([centerFromCp.lat,centerFromCp.lng],11);}}catch(err){setError(err.message||'Erreur r√©seau');}finally{setLoading(false);}};// APPLY FILTERS - seulement pour les filtres appliqu√©s apr√®s la recherche\nconst applyFilters=()=>{if(data.length===0){setFilteredData([]);return;}const filtered=data.filter(company=>{const lat=parseFloat(company.latitude);const lng=parseFloat(company.longitude);if(!lat||!lng)return false;// Filtre distance (utilise le centre actuel)\nconst distance=calculateDistance(center.lat,center.lng,lat,lng);if(distance>filters.radius)return false;// Filtre email\nif(filters.hasEmail&&(!company.contacts||!company.contacts.some(c=>c.email))){return false;}// Filtre t√©l√©phone\nif(filters.hasPhone&&!company.telephone&&(!company.contacts||!company.contacts.some(c=>c.telephone))){return false;}return true;});setFilteredData(filtered);};// Applique les filtres quand ils changent\nuseEffect(()=>{if(data.length>0){applyFilters();}},[filters,center]);// Initialise la carte Leaflet\nuseEffect(()=>{if(!mapRef.current||mapInstance.current)return;mapInstance.current=L.map(mapRef.current).setView([center.lat,center.lng],6);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors',maxZoom:19}).addTo(mapInstance.current);// Nettoyage\nreturn()=>{if(mapInstance.current){mapInstance.current.remove();mapInstance.current=null;}};},[]);// Cr√©e les markers\nuseEffect(()=>{if(!mapInstance.current)return;// Nettoie anciens markers\nmarkersRef.current.forEach(m=>mapInstance.current.removeLayer(m));markersRef.current=[];if(filteredData.length===0)return;const bounds=[];const seenAddresses=new Map();filteredData.forEach(company=>{const lat=parseFloat(company.latitude);const lng=parseFloat(company.longitude);if(!lat||!lng||isNaN(lat)||isNaN(lng))return;// D√©duplication\nconst addressKey=\"\".concat(lat.toFixed(4),\",\").concat(lng.toFixed(4));if(seenAddresses.has(addressKey))return;seenAddresses.set(addressKey,true);// Ic√¥ne personnalis√©e selon la charte graphique\nconst hasContacts=company.contacts&&company.contacts.length>0;const isFavorite=favorites.has(company.siren);// Couleurs selon la charte graphique\nlet iconColor,textColor,symbol;if(isFavorite){iconColor='#00FF89';// Vert pour les favoris\ntextColor='#000000';// Texte noir sur fond vert\nsymbol='‚òÖ';}else if(hasContacts){iconColor='#000000';// Noir pour les entreprises avec contacts\ntextColor='#00FF89';// Texte vert sur fond noir\nsymbol='E';}else{iconColor='#000000';// Noir pour les entreprises sans contacts\ntextColor='#FFFFFF';// Texte blanc sur fond noir\nsymbol='!';}const iconSize=isFavorite?32:24;const borderWidth=isFavorite?3:2;const customIcon=L.divIcon({className:'custom-leaflet-marker',html:\"\\n            <div style=\\\"\\n            background: \".concat(iconColor,\";\\n            width: \").concat(iconSize,\"px;\\n            height: \").concat(iconSize,\"px;\\n            border-radius: 0;\\n            border: \").concat(borderWidth,\"px solid #000000;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            font-family: 'DM Mono', monospace;\\n            font-weight: 500;\\n            color: \").concat(textColor,\";\\n            font-size: \").concat(iconSize*0.5,\"px;\\n            line-height: 1;\\n            transform: translate(-50%, -50%);\\n            \\\">\\n            \").concat(symbol,\"\\n            </div>\\n        \"),iconSize:[iconSize,iconSize],iconAnchor:[iconSize/2,iconSize/2],popupAnchor:[0,-iconSize/2]});const marker=L.marker([lat,lng],{icon:customIcon}).addTo(mapInstance.current).bindPopup(()=>createPopupContent(company)).on('click',()=>setSelectedCompany(company.siren));markersRef.current.push(marker);bounds.push([lat,lng]);});// Ajuste le zoom\nif(bounds.length>0){mapInstance.current.fitBounds(bounds,{padding:[50,50]});}},[filteredData,favorites]);// Popup personnalis√©e COMPACTE\nconst createPopupContent=company=>{const popupContainer=document.createElement('div');popupContainer.className='leaflet-popup-content-custom';const renderPopupContent=()=>{return\"\\n        <div class=\\\"compact-popup\\\">\\n            <h3 class=\\\"popup-title\\\">\".concat(company.name||company.nom||'Entreprise',\"</h3>\\n            \\n            <div class=\\\"popup-section\\\">\\n            <strong>\\uD83D\\uDCCD</strong> \").concat(company.address||company.adresse||'',\" \").concat(company.code_postal||'',\" \").concat(company.ville||'',\"\\n            </div>\\n            \\n            <div class=\\\"popup-section\\\">\\n            <strong>\\uD83C\\uDFE2</strong> \").concat(company.sector||company.secteur||'Non renseign√©',\"\\n            </div>\\n            \\n            \").concat(company.site||company.site_web?\"\\n            <div class=\\\"popup-section\\\">\\n                <strong>\\uD83C\\uDF10</strong> \\n                <a href=\\\"\".concat(company.site||company.site_web,\"\\\" target=\\\"_blank\\\" class=\\\"popup-link\\\">\\n                Site web\\n                </a>\\n            </div>\\n            \"):'',\"\\n            \\n            \").concat(company.telephone?\"\\n            <div class=\\\"popup-section\\\">\\n                <strong>\\uD83D\\uDCDE</strong> \\n                <a href=\\\"tel:\".concat(company.telephone,\"\\\" class=\\\"popup-link\\\">\\n                \").concat(company.telephone,\"\\n                </a>\\n            </div>\\n            \"):'',\"\\n            \\n            <!-- SECTION CONTACTS COMPACTE -->\\n            <div class=\\\"contacts-section\\\">\\n            \").concat(company.contacts&&company.contacts.length>0?\"\\n                <div class=\\\"contacts-dropdown\\\">\\n                <label for=\\\"contact-select-\".concat(company.siren,\"\\\">\\n                    <strong>\\uD83D\\uDC65 Contacts (\").concat(company.contacts.length,\")</strong>\\n                </label>\\n                <select \\n                    id=\\\"contact-select-\").concat(company.siren,\"\\\" \\n                    class=\\\"contact-select\\\"\\n                    onchange=\\\"handleContactSelect(this, '\").concat(company.siren,\"')\\\"\\n                >\\n                    <option value=\\\"\\\">S\\xE9lectionner un contact</option>\\n                    \").concat(company.contacts.map((contact,index)=>\"\\n                    <option value=\\\"\".concat(index,\"\\\" data-contact='\").concat(JSON.stringify(contact).replace(/'/g,\"&#39;\"),\"'>\\n                        \").concat(contact.nom,\" - \").concat(contact.poste,\"\\n                    </option>\\n                    \")).join(''),\"\\n                </select>\\n                \\n                <div id=\\\"contact-details-\").concat(company.siren,\"\\\" class=\\\"contact-details\\\"></div>\\n                </div>\\n            \"):'<div class=\"no-contacts\">Aucun contact</div>',\"\\n            </div>\\n        </div>\\n        \");};popupContainer.innerHTML=renderPopupContent();// Attendre que le DOM soit mis √† jour avant d'ajouter les √©couteurs\nsetTimeout(()=>{// Fonction pour g√©rer la s√©lection des contacts\nwindow.handleContactSelect=function(selectElement,siren){const selectedIndex=selectElement.value;const detailsDiv=document.getElementById(\"contact-details-\".concat(siren));if(selectedIndex&&selectedIndex!==''){const option=selectElement.options[selectElement.selectedIndex];const contact=JSON.parse(option.getAttribute('data-contact').replace(/&#39;/g,\"'\"));detailsDiv.innerHTML=\"\\n            <div class=\\\"selected-contact\\\">\\n              <div class=\\\"contact-header\\\">\\n                <strong>\".concat(contact.nom,\"</strong>\\n                <span class=\\\"confidence-badge \").concat(contact.confidence,\"\\\">\\n                  \").concat(contact.confidence==='high'?'√âlev√©e':contact.confidence==='medium'?'Moyenne':'Faible',\"\\n                </span>\\n              </div>\\n              <div class=\\\"contact-info\\\">\").concat(contact.poste,\"</div>\\n              \").concat(contact.email?\"\\n                <div class=\\\"contact-action\\\">\\n                  <a href=\\\"mailto:\".concat(contact.email,\"\\\" class=\\\"btn-email\\\" target=\\\"_blank\\\">\\n                    \\uD83D\\uDCE7 \").concat(contact.email,\"\\n                  </a>\\n                </div>\\n              \"):'',\"\\n              \").concat(contact.telephone?\"\\n                <div class=\\\"contact-action\\\">\\n                  <a href=\\\"tel:\".concat(contact.telephone,\"\\\" class=\\\"btn-call\\\">\\n                    \\uD83D\\uDCDE \").concat(contact.telephone,\"\\n                  </a>\\n                </div>\\n              \"):'',\"\\n              \").concat(contact.linkedin?\"\\n                <div class=\\\"contact-action\\\">\\n                  <a href=\\\"\".concat(contact.linkedin,\"\\\" class=\\\"btn-linkedin\\\" target=\\\"_blank\\\">\\n                    \\uD83D\\uDD17 LinkedIn\\n                  </a>\\n                </div>\\n              \"):'',\"\\n              <div class=\\\"contact-source\\\">Source: \").concat(contact.source,\"</div>\\n            </div>\\n          \");detailsDiv.style.display='block';}else{detailsDiv.style.display='none';}};},100);return popupContainer;};// Toggle favoris\nconst toggleFavorite=siren=>{const newFavorites=new Set(favorites);if(newFavorites.has(siren)){newFavorites.delete(siren);}else{newFavorites.add(siren);}setFavorites(newFavorites);localStorage.setItem('favorites',JSON.stringify([...newFavorites]));};const focusOnCompany=company=>{if(!company||!mapInstance.current)return;const lat=parseFloat(company.latitude);const lng=parseFloat(company.longitude);if(!lat||!lng||isNaN(lat)||isNaN(lng))return;setTimeout(()=>{mapInstance.current.options.zoomAnimation=false;mapInstance.current.setView([lat,lng],15);setTimeout(()=>{mapInstance.current.options.zoomAnimation=true;const companyMarker=markersRef.current.find(marker=>{const markerLatLng=marker.getLatLng();const latDiff=Math.abs(markerLatLng.lat-lat);const lngDiff=Math.abs(markerLatLng.lng-lng);return latDiff<0.0001&&lngDiff<0.0001;});if(companyMarker){markersRef.current.forEach(marker=>{if(marker!==companyMarker&&marker.isPopupOpen()){marker.closePopup();}});setTimeout(()=>{companyMarker.openPopup();},100);}},50);},500);};return/*#__PURE__*/_jsxs(\"div\",{className:\"prospect-layout\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"sidebar\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"section-title\",children:\"Prospection\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"panel-content\",onSubmit:handleSearch,children:[/*#__PURE__*/_jsx(\"div\",{id:\"search-container\",children:/*#__PURE__*/_jsx(\"input\",{id:\"search-input\",type:\"text\",placeholder:\"Ex: Castorama\",value:companyName,onChange:e=>setCompanyName(e.target.value)})}),/*#__PURE__*/_jsx(\"div\",{id:\"search-container\",children:/*#__PURE__*/_jsx(\"input\",{id:\"search-input\",type:\"text\",placeholder:\"Ex: 75015\",value:postalCode,onChange:e=>setPostalCode(e.target.value)})}),/*#__PURE__*/_jsxs(\"div\",{id:\"association-distance-filter\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"capacity-filter-title\",children:[\"Rayon de recherche : \",filters.radius,\" km\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"capacity-filter-controls\",children:/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"1\",max:\"500\",value:filters.radius,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{radius:parseInt(e.target.value,10)})),className:\"capacity-range\",id:\"distance-slider\",style:{\"--progress\":\"\".concat(filters.radius/500*100,\"%\")}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"slider-labels\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"1 km\"}),/*#__PURE__*/_jsx(\"span\",{children:\"500 km\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'8px'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",type:\"submit\",disabled:loading,children:loading?\"üîÑ Recherche...\":\"Rechercher\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn\",disabled:loading||data.length===0,onClick:async()=>{try{await startAutoEnrich(8);alert('Enrichissement manuel lanc√© (max 8 contacts)');}catch(e){console.error('Erreur auto-enrich:',e);alert('Erreur lors de l\\'enrichissement manuel');}},children:\"\\u26A1 Enrich. contacts\"})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-toggle-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"filter-toggle-label\",htmlFor:\"toggle-email\",children:\"Avec email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"toggle-email\",className:\"filter-toggle-radio\",checked:!!filters.hasEmail,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{hasEmail:e.target.checked}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-toggle-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"filter-toggle-label\",htmlFor:\"toggle-phone\",children:\"Avec t\\xE9l\\xE9phone\"}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"toggle-phone\",className:\"filter-toggle-radio\",checked:!!filters.hasPhone,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{hasPhone:e.target.checked}))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"transaction-list\",children:[filteredData.length===0&&!loading&&/*#__PURE__*/_jsx(\"div\",{className:\"no-results\",children:\"Aucune entreprise trouv\\xE9e\"}),filteredData.sort((a,b)=>{const aIsFavorite=favorites.has(a.siren);const bIsFavorite=favorites.has(b.siren);if(aIsFavorite&&!bIsFavorite)return-1;if(!aIsFavorite&&bIsFavorite)return 1;return 0;}).map((company,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"transaction-card\".concat(selectedCompany===company.siren?\" selected\":\"\").concat(favorites.has(company.siren)?\" favori\":\"\"),onClick:()=>{setSelectedCompany(company.siren);focusOnCompany(company);},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"transaction-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"card-title\",children:company.name||company.nom}),/*#__PURE__*/_jsx(\"button\",{className:\"favorite-btn\",type:\"button\",onClick:e=>{e.stopPropagation();toggleFavorite(company.siren);},children:favorites.has(company.siren)?\"‚òÖ\":\"‚òÜ\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-details\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\uD83D\\uDCCD \",company.ville]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\uD83C\\uDFE2 \",company.sector||company.secteur]}),company.contacts&&company.contacts.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"contact-summary\",children:\"\\uD83D\\uDC65 Contacts disponibles (d\\xE9tails dans la popup de la carte)\"}),company.telephone&&/*#__PURE__*/_jsxs(\"div\",{className:\"company-direct-phone\",children:[\"\\uD83D\\uDCDE\",\" \",/*#__PURE__*/_jsx(\"a\",{href:\"tel:\".concat(company.telephone),onClick:e=>e.stopPropagation(),children:company.telephone})]})]})]},i))]})]})}),/*#__PURE__*/_jsx(\"div\",{id:\"map\",ref:mapRef})]});}","map":{"version":3,"names":["React","useEffect","useRef","useState","L","jsx","_jsx","jsxs","_jsxs","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","MapProspects","_ref","onSearch","mapRef","mapInstance","markersRef","data","setData","filteredData","setFilteredData","companyName","setCompanyName","postalCode","setPostalCode","loading","setLoading","error","setError","center","setCenter","lat","lng","filters","setFilters","radius","hasEmail","hasPhone","favorites","setFavorites","Set","JSON","parse","localStorage","getItem","selectedCompany","setSelectedCompany","calculateDistance","lat1","lon1","lat2","lon2","R","dLat","Math","PI","dLon","a","sin","cos","c","atan2","sqrt","geocodePostal","cp","_json$features","res","fetch","concat","encodeURIComponent","json","feat","features","lon","geometry","coordinates","console","splitName","fullName","arguments","length","undefined","parts","trim","split","firstname","lastname","slice","join","getDomainFromUrl","url","u","URL","startsWith","hostname","replace","_unused","enrichContactWithFullEnrich","company","contact","nom","name","alert","domain","site","method","headers","body","stringify","company_name","linkedin_url","linkedin","ok","enriched","poste","email","telephone","err","startAutoEnrich","limit","enrichedCount","contacts","toString","Promise","r","setTimeout","processContacts","Array","isArray","isStandard","toLowerCase","position","includes","normalizePhone","p","nonStandards","filter","standardCandidates","seenPhones","selectedStandards","s","phone","has","add","push","_objectSpread","handleSearch","e","preventDefault","centerFromCp","radiusKm","text","js","parseErr","status","_js","companies","map","i","id","nom_entreprise","address","adresse","adresse_siege","sector","secteur","libelle_activite_principale","libelle_naf","site_web","latitude","longitude","ville","code_postal","naf","activite_principale","siren","autoEnrich","filtered","parseFloat","isNaN","distance","some","current","setView","message","applyFilters","tileLayer","attribution","maxZoom","addTo","remove","forEach","m","removeLayer","bounds","seenAddresses","Map","addressKey","toFixed","set","hasContacts","isFavorite","iconColor","textColor","symbol","iconSize","borderWidth","customIcon","divIcon","className","html","iconAnchor","popupAnchor","marker","icon","bindPopup","createPopupContent","on","fitBounds","padding","popupContainer","document","createElement","renderPopupContent","index","innerHTML","window","handleContactSelect","selectElement","selectedIndex","value","detailsDiv","getElementById","option","options","getAttribute","confidence","source","style","display","toggleFavorite","newFavorites","delete","setItem","focusOnCompany","zoomAnimation","companyMarker","find","markerLatLng","getLatLng","latDiff","abs","lngDiff","isPopupOpen","closePopup","openPopup","children","onSubmit","type","placeholder","onChange","target","min","max","parseInt","gap","disabled","onClick","htmlFor","checked","sort","b","aIsFavorite","bIsFavorite","stopPropagation","href","ref"],"sources":["/home/dehlia/prospection/tableau-entreprises/frontend/src/MapProspect.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport './MapProspect.css';\n\n// Fix des ic√¥nes Leaflet\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',\n  iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',\n});\n\nexport default function MapProspects({ onSearch }) {\n  const mapRef = useRef(null);\n  const mapInstance = useRef(null);\n  const markersRef = useRef([]);\n  const [data, setData] = useState([]);\n  const [filteredData, setFilteredData] = useState([]);\n  const [companyName, setCompanyName] = useState('');\n  const [postalCode, setPostalCode] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [center, setCenter] = useState({ lat: 48.8566, lng: 2.3522 });\n  const [filters, setFilters] = useState({\n    radius: 100,\n    hasEmail: false,\n    hasPhone: false\n  });\n  const [favorites, setFavorites] = useState(() => {\n    return new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));\n  });\n  const [selectedCompany, setSelectedCompany] = useState(null);\n\n  // Calcul distance (Haversine)\n  const calculateDistance = (lat1, lon1, lat2, lon2) => {\n    const R = 6371;\n    const dLat = (lat2 - lat1) * Math.PI / 180;\n    const dLon = (lon2 - lon1) * Math.PI / 180;\n    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n              Math.sin(dLon/2) * Math.sin(dLon/2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n    return R * c;\n  };\n\n  const geocodePostal = async (cp) => {\n    try {\n      const res = await fetch(\n        `https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(cp)}&limit=1`\n      );\n      const json = await res.json();\n      const feat = json.features?.[0];\n      if (!feat) return null;\n      const [lon, lat] = feat.geometry.coordinates;\n      return { lat, lng: lon };\n    } catch (error) {\n      console.error('Erreur de g√©ocodage:', error);\n      return null;\n    }\n  };\n\n  // util pour extraire pr√©nom/nom √† partir de \"Pr√©nom Nom\"\n      const splitName = (fullName = \"\") => {\n        const parts = fullName.trim().split(\" \");\n        if (parts.length === 1) return { firstname: parts[0], lastname: \"\" };\n        const firstname = parts[0];\n        const lastname = parts.slice(1).join(\" \");\n        return { firstname, lastname };\n      };\n\n      // util pour extraire le domaine d'une URL\n      const getDomainFromUrl = (url = \"\") => {\n        if (!url) return \"\";\n        try {\n          const u = new URL(url.startsWith(\"http\") ? url : `https://${url}`);\n          return u.hostname.replace(/^www\\./, \"\");\n        } catch {\n          return url.replace(/^https?:\\/\\//, \"\").replace(/^www\\./, \"\").split(\"/\")[0];\n        }\n      };\n\n      // Appel de l'endpoint /enrich-contact pour un contact\n      const enrichContactWithFullEnrich = async (company, contact) => {\n        try {\n          const { firstname, lastname } = splitName(contact.nom || contact.name || \"\");\n          if (!firstname) {\n            alert(\"Impossible d'enrichir: le contact n'a pas de nom.\");\n            return;\n          }\n\n          const domain = getDomainFromUrl(company.site);\n\n          const res = await fetch(\"http://localhost:5000/enrich-contact\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              firstname,\n              lastname,\n              company_name: company.name,\n              domain,\n              linkedin_url: contact.linkedin || \"\"\n            })\n          });\n\n          const data = await res.json();\n\n          if (!res.ok) {\n            alert(data.error || \"Erreur FullEnrich\");\n            console.error(\"FullEnrich error:\", data);\n            return;\n          }\n\n          if (!data.data || data.data.length === 0) {\n            alert(\"Aucune donn√©e suppl√©mentaire trouv√©e par FullEnrich.\");\n            return;\n          }\n\n          const enriched = data.data[0];\n          alert(\n            `Enrichi :\\n` +\n            `Nom: ${enriched.nom}\\n` +\n            `Poste: ${enriched.poste}\\n` +\n            `Email: ${enriched.email || \"N/A\"}\\n` +\n            `T√©l√©phone: ${enriched.telephone || \"N/A\"}`\n          );\n        } catch (err) {\n          console.error(\"Erreur enrich-contact:\", err);\n          alert(\"Erreur r√©seau FullEnrich\");\n        }\n      };\n\n      // Manuel: lance l'enrichissement FullEnrich sur un nombre limit√© de contacts (√©vite boucle automatique)\n      const startAutoEnrich = async (limit = 8) => {\n        let enrichedCount = 0;\n        for (const company of data) {\n          if (!company || !company.contacts || company.contacts.length === 0) continue;\n\n          for (const contact of company.contacts) {\n            // n'enrichit que les contacts sans email ni t√©l√©phone pour limiter les appels\n            const hasEmail = contact.email && contact.email.trim().length > 0;\n            const hasPhone = contact.telephone && contact.telephone.toString().replace(/\\D/g,'').length > 0;\n            if (hasEmail || hasPhone) continue;\n\n            if (enrichedCount >= limit) return;\n            await enrichContactWithFullEnrich(company, contact);\n            enrichedCount += 1;\n            await new Promise(r => setTimeout(r, 400));\n          }\n        }\n      };\n\n        // Process contacts: limit standard t√©l√©phonique to max 2 per company\n        const processContacts = (contacts = []) => {\n          if (!Array.isArray(contacts) || contacts.length === 0) return [];\n\n          const isStandard = (c) => {\n            const name = (c.nom || c.name || \"\").toLowerCase();\n            const poste = (c.poste || c.position || \"\").toLowerCase();\n            return name.includes('standard') || poste.includes('standard') || poste.includes('accueil');\n          };\n\n          const normalizePhone = (p = \"\") => (p || \"\").toString().replace(/\\D/g, '');\n\n          const nonStandards = contacts.filter(c => !isStandard(c));\n          const standardCandidates = contacts.filter(c => isStandard(c));\n\n          // Deduplicate standard candidates by phone (keep first seen)\n          const seenPhones = new Set();\n          const selectedStandards = [];\n          for (const s of standardCandidates) {\n            const phone = normalizePhone(s.telephone || s.phone || '');\n            if (phone) {\n              if (!seenPhones.has(phone)) {\n                seenPhones.add(phone);\n                selectedStandards.push({ ...s, telephone: s.telephone || s.phone || '' });\n              }\n            } else {\n              // if no phone, keep but limited\n              selectedStandards.push(s);\n            }\n            if (selectedStandards.length >= 2) break; // limit to 2\n          }\n\n          // If we still have less than 2 standards and some candidates had no phone, fill up to 2\n          if (selectedStandards.length < 2) {\n            for (const s of standardCandidates) {\n              if (selectedStandards.includes(s)) continue;\n              selectedStandards.push(s);\n              if (selectedStandards.length >= 2) break;\n            }\n          }\n\n          return [...nonStandards, ...selectedStandards];\n        };\n\n\n  // FONCTION DE RECHERCHE UNIFI√âE\n  const handleSearch = async (e) => {\n    if (e) e.preventDefault();\n\n    if (!companyName || !postalCode) {\n      setError('Nom et code postal requis');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      // 1. G√âOCODAGE D'ABORD pour avoir un centre pr√©cis\n      const centerFromCp = await geocodePostal(postalCode);\n      if (!centerFromCp) {\n        setError('Code postal introuvable');\n        setLoading(false);\n        return;\n      }\n      \n      setCenter(centerFromCp);\n\n      // 2. Appel backend\n      const res = await fetch('http://localhost:5000/prospect', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          companyName,\n          postalCode,\n          radiusKm: filters.radius || 100,\n        }),\n      });\n\n      const text = await res.text();\n      let js = null;\n      try {\n        js = text ? JSON.parse(text) : null;\n      } catch (parseErr) {\n        setError(`R√©ponse inattendue du serveur (status ${res.status})`);\n        setLoading(false);\n        return;\n      }\n\n      if (!res.ok) {\n        setError(js?.error || `Erreur serveur (${res.status})`);\n        setLoading(false);\n        return;\n      }\n\n      // util pour extraire pr√©nom/nom √† partir de \"Pr√©nom Nom\"\n\n\n      // 3. Mapping des entreprises\n      const companies = (js.data || []).map((c, i) => ({\n        id: i,\n        name: c.nom || c.nom_entreprise || \"Inconnu\",\n        address: c.adresse || c.adresse_siege || \"\",\n        sector: c.secteur || c.libelle_activite_principale || c.libelle_naf || \"\",\n        site: c.site_web || c.site || \"\",\n        telephone: c.telephone || \"\",\n        // Les contacts sont d√©j√† limit√©s et trait√©s par le backend (pas besoin de processContacts ici)\n        contacts: c.contacts || [],\n        latitude: c.latitude || c.lat || null,\n        longitude: c.longitude || c.lng || null,\n        ville: c.ville || \"\",\n        code_postal: c.code_postal || \"\",\n        adresse: c.adresse || \"\",\n        naf: c.naf || c.activite_principale || \"\",\n        siren: c.siren || `temp-${i}`,\n      }));\n\n      // Option : lancer FullEnrich automatiquement sur chaque contact\n      const autoEnrich = async () => {\n        for (const company of companies) {\n          if (!company.site || !company.contacts || company.contacts.length === 0) continue;\n\n          for (const contact of company.contacts) {\n            // tu peux mettre des conditions si tu veux √©viter de tout enrichir\n            // ex : si pas d'email ou pas de t√©l√©phone\n            // if (contact.email && contact.telephone) continue;\n\n            await enrichContactWithFullEnrich(company, contact);\n            // √©ventuellement un petit d√©lai pour ne pas spammer l‚ÄôAPI\n            await new Promise(r => setTimeout(r, 300));\n          }\n        }\n      };\n\n      // Ne lance pas automatiquement l'enrichissement pour √©viter des appels r√©p√©t√©s\n      // autoEnrich();\n\n      setData(companies);\n\n      // 4. FILTRAGE UNIFI√â avec toutes les conditions\n      const filtered = companies.filter(company => {\n        // V√©rification des coordonn√©es\n        const lat = parseFloat(company.latitude);\n        const lng = parseFloat(company.longitude);\n        if (!lat || !lng || isNaN(lat) || isNaN(lng)) return false;\n\n        // Filtre distance\n        const distance = calculateDistance(centerFromCp.lat, centerFromCp.lng, lat, lng);\n        if (distance > filters.radius) return false;\n\n        // Filtre email\n        if (filters.hasEmail && (!company.contacts || !company.contacts.some(c => c.email))) {\n          return false;\n        }\n\n        // Filtre t√©l√©phone\n        if (filters.hasPhone && !company.telephone && (!company.contacts || !company.contacts.some(c => c.telephone))) {\n          return false;\n        }\n\n        return true;\n      });\n\n      setFilteredData(filtered);\n\n      // 5. Centrage de la carte sur le CP g√©ocod√©\n      if (mapInstance.current) {\n        mapInstance.current.setView([centerFromCp.lat, centerFromCp.lng], 11);\n      }\n\n    } catch (err) {\n      setError(err.message || 'Erreur r√©seau');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // APPLY FILTERS - seulement pour les filtres appliqu√©s apr√®s la recherche\n  const applyFilters = () => {\n    if (data.length === 0) {\n      setFilteredData([]);\n      return;\n    }\n\n    const filtered = data.filter(company => {\n      const lat = parseFloat(company.latitude);\n      const lng = parseFloat(company.longitude);\n      \n      if (!lat || !lng) return false;\n\n      // Filtre distance (utilise le centre actuel)\n      const distance = calculateDistance(center.lat, center.lng, lat, lng);\n      if (distance > filters.radius) return false;\n\n      // Filtre email\n      if (filters.hasEmail && (!company.contacts || !company.contacts.some(c => c.email))) {\n        return false;\n      }\n\n      // Filtre t√©l√©phone\n      if (filters.hasPhone && !company.telephone && (!company.contacts || !company.contacts.some(c => c.telephone))) {\n        return false;\n      }\n\n      return true;\n    });\n\n    setFilteredData(filtered);\n  };\n\n  // Applique les filtres quand ils changent\n  useEffect(() => {\n    if (data.length > 0) {\n      applyFilters();\n    }\n  }, [filters, center]);\n\n  // Initialise la carte Leaflet\n  useEffect(() => {\n    if (!mapRef.current || mapInstance.current) return;\n\n    mapInstance.current = L.map(mapRef.current).setView([center.lat, center.lng], 6);\n\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '¬© OpenStreetMap contributors',\n      maxZoom: 19\n    }).addTo(mapInstance.current);\n\n    // Nettoyage\n    return () => {\n      if (mapInstance.current) {\n        mapInstance.current.remove();\n        mapInstance.current = null;\n      }\n    };\n  }, []);\n\n  // Cr√©e les markers\n  useEffect(() => {\n    if (!mapInstance.current) return;\n\n    // Nettoie anciens markers\n    markersRef.current.forEach(m => mapInstance.current.removeLayer(m));\n    markersRef.current = [];\n\n    if (filteredData.length === 0) return;\n\n    const bounds = [];\n    const seenAddresses = new Map();\n\n    filteredData.forEach(company => {\n      const lat = parseFloat(company.latitude);\n      const lng = parseFloat(company.longitude);\n\n      if (!lat || !lng || isNaN(lat) || isNaN(lng)) return;\n\n      // D√©duplication\n      const addressKey = `${lat.toFixed(4)},${lng.toFixed(4)}`;\n      if (seenAddresses.has(addressKey)) return;\n      seenAddresses.set(addressKey, true);\n\n      // Ic√¥ne personnalis√©e selon la charte graphique\n      const hasContacts = company.contacts && company.contacts.length > 0;\n      const isFavorite = favorites.has(company.siren);\n      \n      // Couleurs selon la charte graphique\n      let iconColor, textColor, symbol;\n      \n      if (isFavorite) {\n        iconColor = '#00FF89'; // Vert pour les favoris\n        textColor = '#000000'; // Texte noir sur fond vert\n        symbol = '‚òÖ';\n      } else if (hasContacts) {\n        iconColor = '#000000'; // Noir pour les entreprises avec contacts\n        textColor = '#00FF89'; // Texte vert sur fond noir\n        symbol = 'E';\n      } else {\n        iconColor = '#000000'; // Noir pour les entreprises sans contacts\n        textColor = '#FFFFFF'; // Texte blanc sur fond noir\n        symbol = '!';\n      }\n\n      const iconSize = isFavorite ? 32 : 24;\n      const borderWidth = isFavorite ? 3 : 2;\n\n      const customIcon = L.divIcon({\n        className: 'custom-leaflet-marker',\n        html: `\n            <div style=\"\n            background: ${iconColor};\n            width: ${iconSize}px;\n            height: ${iconSize}px;\n            border-radius: 0;\n            border: ${borderWidth}px solid #000000;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-family: 'DM Mono', monospace;\n            font-weight: 500;\n            color: ${textColor};\n            font-size: ${iconSize * 0.5}px;\n            line-height: 1;\n            transform: translate(-50%, -50%);\n            \">\n            ${symbol}\n            </div>\n        `,\n        iconSize: [iconSize, iconSize],\n        iconAnchor: [iconSize/2, iconSize/2],\n        popupAnchor: [0, -iconSize/2]\n        });\n\n      const marker = L.marker([lat, lng], { icon: customIcon })\n        .addTo(mapInstance.current)\n        .bindPopup(() => createPopupContent(company))\n        .on('click', () => setSelectedCompany(company.siren));\n\n      markersRef.current.push(marker);\n      bounds.push([lat, lng]);\n    });\n\n    // Ajuste le zoom\n    if (bounds.length > 0) {\n      mapInstance.current.fitBounds(bounds, { padding: [50, 50] });\n    }\n  }, [filteredData, favorites]);\n\n\n\n   \n  // Popup personnalis√©e COMPACTE\n  const createPopupContent = (company) => {\n    const popupContainer = document.createElement('div');\n    popupContainer.className = 'leaflet-popup-content-custom';\n    \n    const renderPopupContent = () => {\n        return `\n        <div class=\"compact-popup\">\n            <h3 class=\"popup-title\">${company.name || company.nom || 'Entreprise'}</h3>\n            \n            <div class=\"popup-section\">\n            <strong>üìç</strong> ${company.address || company.adresse || ''} ${company.code_postal || ''} ${company.ville || ''}\n            </div>\n            \n            <div class=\"popup-section\">\n            <strong>üè¢</strong> ${company.sector || company.secteur || 'Non renseign√©'}\n            </div>\n            \n            ${company.site || company.site_web ? `\n            <div class=\"popup-section\">\n                <strong>üåê</strong> \n                <a href=\"${company.site || company.site_web}\" target=\"_blank\" class=\"popup-link\">\n                Site web\n                </a>\n            </div>\n            ` : ''}\n            \n            ${company.telephone ? `\n            <div class=\"popup-section\">\n                <strong>üìû</strong> \n                <a href=\"tel:${company.telephone}\" class=\"popup-link\">\n                ${company.telephone}\n                </a>\n            </div>\n            ` : ''}\n            \n            <!-- SECTION CONTACTS COMPACTE -->\n            <div class=\"contacts-section\">\n            ${company.contacts && company.contacts.length > 0 ? `\n                <div class=\"contacts-dropdown\">\n                <label for=\"contact-select-${company.siren}\">\n                    <strong>üë• Contacts (${company.contacts.length})</strong>\n                </label>\n                <select \n                    id=\"contact-select-${company.siren}\" \n                    class=\"contact-select\"\n                    onchange=\"handleContactSelect(this, '${company.siren}')\"\n                >\n                    <option value=\"\">S√©lectionner un contact</option>\n                    ${company.contacts.map((contact, index) => `\n                    <option value=\"${index}\" data-contact='${JSON.stringify(contact).replace(/'/g, \"&#39;\")}'>\n                        ${contact.nom} - ${contact.poste}\n                    </option>\n                    `).join('')}\n                </select>\n                \n                <div id=\"contact-details-${company.siren}\" class=\"contact-details\"></div>\n                </div>\n            ` : '<div class=\"no-contacts\">Aucun contact</div>'}\n            </div>\n        </div>\n        `;\n    };\n    popupContainer.innerHTML = renderPopupContent();\n\n    // Attendre que le DOM soit mis √† jour avant d'ajouter les √©couteurs\n    setTimeout(() => {\n      // Fonction pour g√©rer la s√©lection des contacts\n      window.handleContactSelect = function(selectElement, siren) {\n        const selectedIndex = selectElement.value;\n        const detailsDiv = document.getElementById(`contact-details-${siren}`);\n        \n        if (selectedIndex && selectedIndex !== '') {\n          const option = selectElement.options[selectElement.selectedIndex];\n          const contact = JSON.parse(option.getAttribute('data-contact').replace(/&#39;/g, \"'\"));\n          \n          detailsDiv.innerHTML = `\n            <div class=\"selected-contact\">\n              <div class=\"contact-header\">\n                <strong>${contact.nom}</strong>\n                <span class=\"confidence-badge ${contact.confidence}\">\n                  ${contact.confidence === 'high' ? '√âlev√©e' : contact.confidence === 'medium' ? 'Moyenne' : 'Faible'}\n                </span>\n              </div>\n              <div class=\"contact-info\">${contact.poste}</div>\n              ${contact.email ? `\n                <div class=\"contact-action\">\n                  <a href=\"mailto:${contact.email}\" class=\"btn-email\" target=\"_blank\">\n                    üìß ${contact.email}\n                  </a>\n                </div>\n              ` : ''}\n              ${contact.telephone ? `\n                <div class=\"contact-action\">\n                  <a href=\"tel:${contact.telephone}\" class=\"btn-call\">\n                    üìû ${contact.telephone}\n                  </a>\n                </div>\n              ` : ''}\n              ${contact.linkedin ? `\n                <div class=\"contact-action\">\n                  <a href=\"${contact.linkedin}\" class=\"btn-linkedin\" target=\"_blank\">\n                    üîó LinkedIn\n                  </a>\n                </div>\n              ` : ''}\n              <div class=\"contact-source\">Source: ${contact.source}</div>\n            </div>\n          `;\n          detailsDiv.style.display = 'block';\n        } else {\n          detailsDiv.style.display = 'none';\n        }\n      };\n    }, 100);\n\n    return popupContainer;\n  };\n\n  // Toggle favoris\n  const toggleFavorite = (siren) => {\n    const newFavorites = new Set(favorites);\n    if (newFavorites.has(siren)) {\n      newFavorites.delete(siren);\n    } else {\n      newFavorites.add(siren);\n    }\n    setFavorites(newFavorites);\n    localStorage.setItem('favorites', JSON.stringify([...newFavorites]));\n  };\n\n  const focusOnCompany = (company) => {\n    if (!company || !mapInstance.current) return;\n\n    const lat = parseFloat(company.latitude);\n    const lng = parseFloat(company.longitude);\n    \n    if (!lat || !lng || isNaN(lat) || isNaN(lng)) return;\n\n    setTimeout(() => {\n      mapInstance.current.options.zoomAnimation = false;\n      mapInstance.current.setView([lat, lng], 15);\n      \n      setTimeout(() => {\n        mapInstance.current.options.zoomAnimation = true;\n        \n        const companyMarker = markersRef.current.find(marker => {\n          const markerLatLng = marker.getLatLng();\n          const latDiff = Math.abs(markerLatLng.lat - lat);\n          const lngDiff = Math.abs(markerLatLng.lng - lng);\n          return latDiff < 0.0001 && lngDiff < 0.0001;\n        });\n\n        if (companyMarker) {\n          markersRef.current.forEach(marker => {\n            if (marker !== companyMarker && marker.isPopupOpen()) {\n              marker.closePopup();\n            }\n          });\n          \n          setTimeout(() => {\n            companyMarker.openPopup();\n          }, 100);\n        }\n      }, 50);\n    }, 500);\n  };\n\n  return (\n    <div className=\"prospect-layout\">\n      {/* Sidebar principal */}\n      <div id=\"sidebar\">\n        <div className=\"sidebar-center\">\n          {/* Titre de section */}\n          <h2 className=\"section-title\">Prospection</h2>\n\n          {/* Formulaire de recherche */}\n          <form className=\"panel-content\" onSubmit={handleSearch}>\n            <div id=\"search-container\">\n              <input\n                id=\"search-input\"\n                type=\"text\"\n                placeholder=\"Ex: Castorama\"\n                value={companyName}\n                onChange={(e) => setCompanyName(e.target.value)}\n              />\n            </div>\n            <div id=\"search-container\">\n              <input\n                id=\"search-input\"\n                type=\"text\"\n                placeholder=\"Ex: 75015\"\n                value={postalCode}\n                onChange={(e) => setPostalCode(e.target.value)}\n              />\n            </div>\n\n            {/* Filtre rayon avec slider */}\n            <div id=\"association-distance-filter\">\n              <div className=\"capacity-filter-title\">\n                Rayon de recherche : {filters.radius} km\n              </div>\n              <div className=\"capacity-filter-controls\">\n                <input\n                  type=\"range\"\n                  min=\"1\"\n                  max=\"500\"\n                  value={filters.radius}\n                  onChange={(e) =>\n                    setFilters({\n                      ...filters,\n                      radius: parseInt(e.target.value, 10),\n                    })\n                  }\n                  className=\"capacity-range\"\n                  id=\"distance-slider\"\n                  style={{\n                    \"--progress\": `${(filters.radius / 500) * 100}%`,\n                  }}\n                />\n              </div>\n              <div className=\"slider-labels\">\n                <span>1 km</span>\n                <span>500 km</span>\n              </div>\n            </div>\n\n            <div style={{ display: 'flex', gap: '8px' }}>\n              <button className=\"btn btn-primary\" type=\"submit\" disabled={loading}>\n                {loading ? \"üîÑ Recherche...\" : \"Rechercher\"}\n              </button>\n              <button\n                type=\"button\"\n                className=\"btn\"\n                disabled={loading || data.length === 0}\n                onClick={async () => {\n                  try {\n                    await startAutoEnrich(8);\n                    alert('Enrichissement manuel lanc√© (max 8 contacts)');\n                  } catch (e) {\n                    console.error('Erreur auto-enrich:', e);\n                    alert('Erreur lors de l\\'enrichissement manuel');\n                  }\n                }}\n              >\n                ‚ö° Enrich. contacts\n              </button>\n            </div>\n          </form>\n\n          {error && <div className=\"error-message\">{error}</div>}\n\n          {/* Filtres simplifi√©s */}\n          <div className=\"filters-section\">\n            <div className=\"filter-toggle-group\">\n              <label className=\"filter-toggle-label\" htmlFor=\"toggle-email\">\n                Avec email\n              </label>\n              <input\n                type=\"checkbox\"\n                id=\"toggle-email\"\n                className=\"filter-toggle-radio\"\n                checked={!!filters.hasEmail}\n                onChange={(e) =>\n                  setFilters({ ...filters, hasEmail: e.target.checked })\n                }\n              />\n            </div>\n\n            <div className=\"filter-toggle-group\">\n              <label className=\"filter-toggle-label\" htmlFor=\"toggle-phone\">\n                Avec t√©l√©phone\n              </label>\n              <input\n                type=\"checkbox\"\n                id=\"toggle-phone\"\n                className=\"filter-toggle-radio\"\n                checked={!!filters.hasPhone}\n                onChange={(e) =>\n                  setFilters({ ...filters, hasPhone: e.target.checked })\n                }\n              />\n            </div>\n          </div>\n\n          {/* Liste des entreprises */}\n          <div className=\"transaction-list\">\n            {filteredData.length === 0 && !loading && (\n              <div className=\"no-results\">Aucune entreprise trouv√©e</div>\n            )}\n\n            {filteredData\n              .sort((a, b) => {\n                const aIsFavorite = favorites.has(a.siren);\n                const bIsFavorite = favorites.has(b.siren);\n\n                if (aIsFavorite && !bIsFavorite) return -1;\n                if (!aIsFavorite && bIsFavorite) return 1;\n                return 0;\n              })\n              .map((company, i) => (\n                <div\n                  className={`transaction-card${\n                    selectedCompany === company.siren ? \" selected\" : \"\"\n                  }${favorites.has(company.siren) ? \" favori\" : \"\"}`}\n                  key={i}\n                  onClick={() => {\n                    setSelectedCompany(company.siren);\n                    focusOnCompany(company);\n                  }}\n                >\n                  <div className=\"transaction-header\">\n                    <span className=\"card-title\">\n                      {company.name || company.nom}\n                    </span>\n                    <button\n                      className=\"favorite-btn\"\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        toggleFavorite(company.siren);\n                      }}\n                    >\n                      {favorites.has(company.siren) ? \"‚òÖ\" : \"‚òÜ\"}\n                    </button>\n                  </div>\n\n                  <div className=\"card-details\">\n                    <div>üìç {company.ville}</div>\n                    <div>üè¢ {company.sector || company.secteur}</div>\n\n                    {/* Indication simple qu'il existe des contacts */}\n                    {company.contacts && company.contacts.length > 0 && (\n                      <div className=\"contact-summary\">\n                        üë• Contacts disponibles (d√©tails dans la popup de la carte)\n                      </div>\n                    )}\n\n                    {/* T√©l√©phone direct de l'entreprise si disponible */}\n                    {company.telephone && (\n                      <div className=\"company-direct-phone\">\n                        üìû{\" \"}\n                        <a\n                          href={`tel:${company.telephone}`}\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          {company.telephone}\n                        </a>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Carte interactive */}\n      <div id=\"map\" ref={mapRef}></div>\n    </div>\n  );\n  }"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}